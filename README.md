# Assessor Website (2026)

This repository contains a Drupal-based website (with CiviCRM modules present) and a Docker Compose setup to run the stack locally: a Drupal application, a MariaDB database, and an Nginx reverse proxy.

## Quick plan
- Inspect `docker-compose.yml` to understand how the app is wired.
- Provide quick start instructions, environment variables, and useful paths for development.

## Requirements (assumptions)
- Docker and Docker Compose installed on the host.
- A `.env` file (or environment) with database credentials and optional port override. See sample below.

## Quick start (development)
1. Create a `.env` file in the repository root with the variables below (or export them into your shell):

```powershell
# .env (example)
DB_NAME=drupal
DB_USER=drupal
DB_PASSWORD=drupal_password
DB_ROOT_PASSWORD=root_password
PORT_HTTP=8080
```

2. Build and start the stack:

```powershell
docker compose up -d --build
```

3. Access the site in your browser at http://localhost:8080 (or the port you set in `PORT_HTTP`).

4. Stop the stack:

```powershell
docker compose down
```

## Services (from `docker-compose.yml`)
- drupal: Built from `docker/Dockerfile`. Mounts the `web/` directory into `/var/www/html` and uses environment variables to connect to the database.
- db: MariaDB (10.11) for persistent site data. Uses `db_data` volume for /var/lib/mysql.
- nginx: Nginx (stable-alpine) as a reverse proxy serving the Drupal site; maps host port `${PORT_HTTP:-8080}` to container port 80 and mounts `nginx/default.conf`.

## Volumes
- `db_data` — MariaDB data, persisted under Docker volumes.
- `drupal_data` — site files under `/var/www/html` in the Drupal container. The compose file mounts the workspace `web/` directories into the container so edits in the workspace are reflected inside the container.

## Important repository paths
- `docker/` — Docker image build context and `Dockerfile` used to build the `drupal` service.
- `nginx/default.conf` — Nginx configuration used by the `nginx` service.
- `web/` — Drupal code and assets. Notable contents:
  - `web/composer.json` and `web/composer.lock` — composer manifests used by the container.
  - `web/modules/` — contrib/custom modules. Contains `civicrm/` with CiviCRM integration files and module code.
  - `web/sites/` — Drupal site configurations and default settings.

## Environment variables used by compose
- `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `DB_ROOT_PASSWORD` — used to configure MariaDB and Drupal database connection.
- `PORT_HTTP` — optional port mapping for Nginx (defaults to 8080 when not provided).

## Development notes
- The `drupal` service mounts `web/` into the container which means you can edit PHP, YAML and other assets locally and reload the site.
- Composer operations (install/update) should be executed where appropriate: either from the host (if PHP & Composer configured) or inside the `drupal` container (recommended to match environment). Example:

```powershell
# Run composer inside the running drupal container (replace container name if different)
docker exec -it drupal_app composer install
```

## Troubleshooting
- If the database container fails to start, check logs:

```powershell
docker compose logs db --follow
```

- If the site is not reachable, confirm Nginx is running and the port is available:

```powershell
docker compose ps
```

## Useful commands
- Start (build if needed): `docker compose up -d --build`
- Stop and remove containers: `docker compose down`
- View logs (follow): `docker compose logs -f`
- Execute a shell in the drupal container: `docker exec -it drupal_app /bin/bash` (or `/bin/sh`)

## Next steps / suggestions
- Add a `README.local.md` or `DEVELOPMENT.md` with site-specific setup (Drupal install profile, admin user, CiviCRM bootstrap steps).
- Add a sample `.env.example` to the repo for clearer onboarding.

---
Generated by examining `docker-compose.yml` and repository layout. If you'd like, I can also:
- add a `.env.example` file,
- create a short `DEVELOPMENT.md` with composer & drush workflows, or
- validate container startup and capture `docker compose ps` / logs from your environment.
